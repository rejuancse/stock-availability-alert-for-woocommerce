jQuery(document).ready(function(t){function r(e){t(".error-message").remove(),t("#notify-me-form").prepend('<p class="error-message">'+n(e)+"</p>")}function n(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}t("#notify-me-button").click(function(){t("#notify-me-form").toggle()}),t("#submit-notify").click(function(){var e=t("#notify-email").val().trim(),a=t("#notify-product-id").val();e&&/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(e)?a?(t("#submit-notify").prop("disabled",!0).text("Submitting..."),t(".error-message, .success-message").remove(),t.ajax({url:notify_ajax.ajax_url,type:"POST",data:{action:"stock_notification",email:e,product_id:a},success:function(e){var a;e.success?e.data.alternatives&&0<e.data.alternatives.length&&(a='<h3>In the meantime, you might also like:</h3><ul class="product-alternatives">',e.data.alternatives.forEach(function(e){a+='<li><a href="'+n(e.url)+'"><img src="'+n(e.image)+'" alt="'+n(e.name)+'" width="50" height="50"><span class="product-name">'+n(e.name)+'</span><span class="product-price">'+n(e.price)+"</span></a></li>"}),a+="</ul>",t("#notify-me-form").after(a)):r(e.data||"Unknown error occurred. Please try again.")},error:function(e,a,t){r("An error occurred. Please try again later. Error: "+a)},complete:function(){t("#submit-notify").prop("disabled",!1).text("Submit")}})):r("Error: Product ID not found. Please refresh the page and try again."):r("Please enter a valid email address.")}),t(document).on("click",".unsubscribe-link",function(e){e.preventDefault();var e=decodeURIComponent(t(this).data("email")),a=t(this).data("product");t.ajax({url:notify_ajax.ajax_url,type:"POST",data:{action:"unsubscribe_stock_notification",email:e,product_id:a,token:"some_security_token"},success:function(e){e.success?t("#notify-me-form").html('<p class="success-message">'+e.data+"</p>"):r(e.data)},error:function(e,a,t){r("An error occurred while unsubscribing. Please try again later.")}})})});