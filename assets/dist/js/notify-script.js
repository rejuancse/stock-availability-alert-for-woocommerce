jQuery(document).ready(function(s){function i(e){s(".error-message").remove(),s("#notify-me-form").prepend('<p class="error-message">'+o(e)+"</p>")}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}s("#notify-me-button").click(function(){s("#notify-me-form").toggle()}),s("#submit-notify").click(function(){var r=s("#notify-email").val().trim(),n=s("#notify-product-id").val();r&&/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(r)?n?(s("#submit-notify").prop("disabled",!0).text("Submitting..."),s(".error-message, .success-message").remove(),s.ajax({url:notify_ajax.ajax_url,type:"POST",data:{action:"stock_notification",email:r,product_id:n},success:function(e){var a,t;e.success?(a='<a href="#" class="unsubscribe-link" data-email="'+encodeURIComponent(r)+'" data-product="'+n+'">Unsubscribe</a>',s("#notify-me-form").html('<p class="success-message">'+e.data.message+"</p><p>"+a+"</p>"),e.data.alternatives&&0<e.data.alternatives.length&&(t='<h3>In the meantime, you might also like:</h3><ul class="product-alternatives">',e.data.alternatives.forEach(function(e){t+='<li><a href="'+o(e.url)+'"><img src="'+o(e.image)+'" alt="'+o(e.name)+'" width="50" height="50"><span class="product-name">'+o(e.name)+'</span><span class="product-price">'+o(e.price)+"</span></a></li>"}),t+="</ul>",s("#notify-me-form").after(t))):i(e.data||"Unknown error occurred. Please try again.")},error:function(e,a,t){i("An error occurred. Please try again later. Error: "+a)},complete:function(){s("#submit-notify").prop("disabled",!1).text("Submit")}})):i("Error: Product ID not found. Please refresh the page and try again."):i("Please enter a valid email address.")}),s(document).on("click",".unsubscribe-link",function(e){e.preventDefault();var e=decodeURIComponent(s(this).data("email")),a=s(this).data("product");s.ajax({url:notify_ajax.ajax_url,type:"POST",data:{action:"unsubscribe_stock_notification",email:e,product_id:a,token:"some_security_token"},success:function(e){e.success?s("#notify-me-form").html('<p class="success-message">'+e.data+"</p>"):i(e.data)},error:function(e,a,t){i("An error occurred while unsubscribing. Please try again later.")}})})});